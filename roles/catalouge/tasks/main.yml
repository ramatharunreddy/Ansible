- name: "Disabling servcie"
  ansible.builtin.command: dnf module disable nodejs -y

- name: "Enabling module"
  ansible.builtin.command: dnf module enable nodejs:20 -y 

- name: "Installing Nodejs servcie"
  ansible.builtin.package:
   name: nodejs
   state: present
  #enabled: yes

- name: "creating system user"
  ansible.builtin.user:
   name: roboshop
   comment: "roboshop system user"
   shell: /sbin/nologin
   home: /app

- name: "creating directory"
  ansible.builtin.file:
   name: /app
   state: directory

- name: "Downloding application code"
  ansible.builtin.command: curl -o /tmp/catalogue.zip https://roboshop-artifacts.s3.amazonaws.com/catalogue-v3.zip

- name: "unarchive the file"
  ansible.builtin.unarchive:
   src: https://roboshop-artifacts.s3.amazonaws.com/catalogue-v3.zip 
   dest: /app
   remote_src: yes
 
- name: "Installing dependencies"
  community.genearal.npm:
   path: /app

- name: "seting up catalouge services"
  ansible.builtin.template:
   src: "{{ component }}.services.j2"
   dest: "/etc/systemd/system/{{ component }}.service"

- name: "restating Deamon"
  ansible.builtin.systemd_service:
   deamon_relaod: true

- name: "restating Deamon"
  ansible.builtin.systemd_service:
    name: "{{ component }}"
    state: restarted